# MCP Portal da Transpar√™ncia

[![npm version](https://badge.fury.io/js/mcp-portal-transparencia.svg)](https://badge.fury.io/js/mcp-portal-transparencia)
[![License: ISC](https://img.shields.io/badge/License-ISC-blue.svg)](https://opensource.org/licenses/ISC)
[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=flat&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)

Um Multi-step Call Planner (MCP) para orquestra√ß√£o de chamadas √† API do Portal da Transpar√™ncia do Governo Federal brasileiro.

## üìã Sobre o Projeto

Este projeto implementa um MCP (Multi-step Call Planner) que automatiza e orquestra chamadas para todos os endpoints dispon√≠veis na API do Portal da Transpar√™ncia (https://api.portaldatransparencia.gov.br/v3/api-docs). O sistema oferece:

- **Gera√ß√£o autom√°tica de clientes TypeScript** a partir do Swagger/OpenAPI
- **Orquestra√ß√£o inteligente** de m√∫ltiplas chamadas de API
- **Tratamento robusto de erros** e rate limiting
- **Logs estruturados** em JSON para monitoramento
- **Autentica√ß√£o centralizada** com suporte a API Key

## üöÄ Funcionalidades

### ‚úÖ Caracter√≠sticas Principais

- üîÑ **Importa√ß√£o autom√°tica** do spec Swagger V3
- üèóÔ∏è **Gera√ß√£o de clientes TypeScript** para cada endpoint
- üîê **Sistema de autentica√ß√£o** com API Key e vari√°veis de ambiente
- ‚ö° **Rate limiting inteligente** com alertas (90/min diurno, 300/min noturno)
- üìä **Logging estruturado** com m√©tricas de sucesso/falha
- üîß **Tratamento de erros** categorizado (4xx vs 5xx)
- üìö **Documenta√ß√£o completa** e exemplos de uso

### üéØ Endpoints Suportados

- **Viagens a Servi√ßo** - Consultas de viagens de servidores p√∫blicos
- **Servidores** - Dados do Poder Executivo Federal
- **Licita√ß√µes** - Informa√ß√µes sobre processos licitat√≥rios
- **Contratos** - Contratos do Poder Executivo Federal
- **Despesas P√∫blicas** - Gastos e empenhos governamentais
- **Benef√≠cios** - Programas sociais e benef√≠cios
- **San√ß√µes** - CNEP, CEIS e CEPIM
- **Conv√™nios** - Acordos e transfer√™ncias
- **E muito mais...** (veja a documenta√ß√£o completa)

## üõ†Ô∏è Instala√ß√£o

### Uso via npx (Recomendado para MCP Server)

```bash
# Executar MCP Server diretamente (para Claude Desktop, Cursor, etc.)
npx mcp-portal-transparencia

# Ou instalar globalmente
npm install -g mcp-portal-transparencia
mcp-portal-transparencia
```

### Instala√ß√£o local

```bash
# Instalar via npm
npm install mcp-portal-transparencia

# Ou via yarn
yarn add mcp-portal-transparencia
```

## ‚öôÔ∏è Configura√ß√£o

### Pr√©-requisitos

- Node.js >= 16.0
- Uma chave de API do Portal da Transpar√™ncia (obrigat√≥ria para MCP Server)

### Vari√°veis de Ambiente

Para usar o MCP Server, configure as vari√°veis de ambiente:

```env
# API Key do Portal da Transpar√™ncia (obrigat√≥ria)
PORTAL_API_KEY=sua_api_key_aqui

# Configura√ß√µes opcionais
LOG_LEVEL=info
```

### Configura√ß√£o para Claude Desktop

Adicione ao seu `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "portal-transparencia": {
      "command": "npx",
      "args": ["mcp-portal-transparencia"],
      "env": {
        "PORTAL_API_KEY": "sua_api_key_aqui"
      }
    }
  }
}
```

### Configura√ß√£o para Cursor

Adicione ao seu `.cursor/mcp.json`:

```json
{
  "mcpServers": {
    "portal-transparencia": {
      "command": "npx",
      "args": ["mcp-portal-transparencia"],
      "env": {
        "PORTAL_API_KEY": "sua_api_key_aqui"
      }
    }
  }
}
```

## üîç MCP Inspector - Teste Local e Visual

O [MCP Inspector](https://github.com/modelcontextprotocol/inspector) √© uma ferramenta oficial da Anthropic que permite testar visualmente todas as ferramentas MCP em uma interface web interativa. √â perfeito para desenvolvimento e debugging.

### üöÄ Como Usar o Inspector

#### 1. Pr√©-requisitos

```bash
# Obter uma API key gratuita
# Acesse: https://api.portaldatransparencia.gov.br/api-de-dados/cadastrar-email
```

#### 2. Configura√ß√£o R√°pida

```bash
# 1. Clone ou baixe este projeto
git clone https://github.com/seu-usuario/mcp-portal-transparencia.git
cd mcp-portal-transparencia

# 2. Configure sua API key
echo "PORTAL_API_KEY=sua_api_key_aqui" > .env

# 3. Fa√ßa o build do projeto
npm run build

# 4. Execute o MCP Inspector
PORTAL_API_KEY=sua_api_key_aqui npx @modelcontextprotocol/inspector node dist/src/mcp-server.js
```

#### 3. Acesso √† Interface

Ap√≥s executar o comando acima, voc√™ ver√° uma sa√≠da similar a:

```
üîó Open inspector with token pre-filled:
   http://localhost:6274/?MCP_PROXY_AUTH_TOKEN=seu_token_aqui

üîç MCP Inspector is up and running at http://127.0.0.1:6274 üöÄ
```

**Clique no link** que aparece no terminal para acessar o inspector com autentica√ß√£o autom√°tica!

#### 4. Interface Visual

No MCP Inspector voc√™ pode:

- ‚úÖ **Ver todas as 106+ ferramentas** geradas automaticamente
- üîß **Testar qualquer ferramenta** com par√¢metros personalizados
- üìä **Visualizar respostas** em JSON formatado
- üîç **Filtrar ferramentas** por categoria ou nome
- üìñ **Ver documenta√ß√£o** de cada ferramenta

#### 5. Exemplo de Teste - Minist√©rio da Fazenda

1. **Verificar API Key**:
   - Ferramenta: `portal_check_api_key`
   - Par√¢metros: `{}` (vazio)

2. **Consultar Servidores da Fazenda**:
   - Ferramenta: `portal_servidores_consultar`
   - Par√¢metros:
     ```json
     {
       "orgaoServidorLotacao": "26000",
       "pagina": 1
     }
     ```

3. **Buscar Despesas da Fazenda**:
   - Ferramenta: `portal_despesas_consultar`
   - Par√¢metros:
     ```json
     {
       "codigoOrgao": "26000",
       "mesAno": 202412,
       "pagina": 1
     }
     ```

### üìù Scripts NPM Adicionais

Para facilitar o uso, voc√™ pode usar os scripts npm:

```bash
# Executar o inspector diretamente
npm run inspector:direct

# Executar com arquivo de configura√ß√£o
npm run inspector

# Ver demonstra√ß√£o das ferramentas
npm run demo
```

### üêõ Resolu√ß√£o de Problemas

**Problema**: Erro 401 "Chave de API n√£o informada"

```bash
# Solu√ß√£o: Verificar se a API key est√° configurada
echo $PORTAL_API_KEY  # Deve mostrar sua chave

# Ou reconfigurar
export PORTAL_API_KEY=sua_chave_aqui
```

**Problema**: Erro de conex√£o no inspector

```bash
# Solu√ß√£o: Verificar se o build foi feito
npm run build

# E tentar novamente
PORTAL_API_KEY=sua_chave_aqui npx @modelcontextprotocol/inspector node dist/src/mcp-server.js
```

**Problema**: Porta ocupada

```bash
# Solu√ß√£o: Matar processos na porta
pkill -f inspector
# E tentar novamente
```

### üí° Dicas do Inspector

- üéØ **Filtros**: Use `portal_ministerio_fazenda` para ver apenas ferramentas da Fazenda
- üìä **Favoritos**: Salve combina√ß√µes de par√¢metros usadas frequentemente
- üîÑ **Re-execu√ß√£o**: Use `Ctrl+Enter` para re-executar rapidamente
- üìã **Copiar**: Clique em qualquer resposta para copiar o JSON
- üåì **Modo Escuro**: Dispon√≠vel no menu de configura√ß√µes

## üìñ Uso via MCP (Recomendado)

O MCP Server permite usar o Portal da Transpar√™ncia diretamente atrav√©s de ferramentas como Claude Desktop, Cursor, e outras interfaces compat√≠veis com MCP.

### Ferramentas Dispon√≠veis

Ap√≥s configurar o MCP Server, voc√™ ter√° acesso a todas as ferramentas geradas automaticamente:

- `portal_check_api_key` - Verificar se a API key est√° configurada
- `portal_servidores_*` - Consultar dados de servidores p√∫blicos
- `portal_viagens_*` - Consultar viagens a servi√ßo
- `portal_contratos_*` - Consultar contratos p√∫blicos
- `portal_despesas_*` - Consultar despesas p√∫blicas
- `portal_beneficios_*` - Consultar programas sociais
- E muitas outras...

### Exemplos de Uso no Claude

```
üîç Consultar servidores do Minist√©rio da Fazenda
üéØ Buscar contratos acima de R$ 1 milh√£o
üìä Analisar despesas por √≥rg√£o no √∫ltimo trimestre
üèõÔ∏è Verificar benef√≠cios sociais por regi√£o
```

## üìñ Uso Program√°tico (Biblioteca)

```typescript
import { PortalTransparenciaClient } from 'mcp-portal-transparencia';

// Inicializar o cliente
const client = new PortalTransparenciaClient({
  apiKey: process.env.PORTAL_API_KEY,
  enableRateLimitAlerts: true,
  logLevel: 'info',
});

// Exemplo: Consultar viagens por per√≠odo
const viagens = await client.viagens.consultar({
  dataIdaDe: '01/01/2024',
  dataIdaAte: '31/01/2024',
  dataRetornoDe: '01/01/2024',
  dataRetornoAte: '31/01/2024',
  codigoOrgao: '26000',
  pagina: 1,
});

// Exemplo: Consultar servidores
const servidores = await client.servidores.consultar({
  orgaoServidorLotacao: '26000',
  pagina: 1,
});

// Exemplo: Buscar licita√ß√µes
const licitacoes = await client.licitacoes.consultar({
  dataInicial: '01/01/2024',
  dataFinal: '31/01/2024',
  codigoOrgao: '26000',
  pagina: 1,
});
```

## üîß Funcionalidades Avan√ßadas

### Rate Limiting e Alertas

O sistema monitora automaticamente o rate limiting da API:

```typescript
// O cliente alerta automaticamente quando atingir 80% do limite
// Limites: 90 req/min (06:00-23:59) | 300 req/min (00:00-05:59)

client.on('rateLimitWarning', info => {
  console.log(`Aviso: ${info.percentage}% do rate limit atingido`);
});

client.on('rateLimitExceeded', error => {
  console.error('Rate limit excedido:', error.message);
});
```

### Orquestra√ß√£o de M√∫ltiplas Chamadas

```typescript
// Exemplo de busca correlacionada
const resultado = await client
  .orchestrator()
  .addStep('orgaos', () => client.orgaos.listarSiafi({ pagina: 1 }))
  .addStep('servidores', prev =>
    client.servidores.consultar({
      orgaoServidorLotacao: prev.orgaos[0].codigo,
      pagina: 1,
    })
  )
  .addStep('remuneracoes', prev =>
    client.servidores.consultarRemuneracao({
      cpf: prev.servidores[0].cpf,
      mesAno: 202401,
      pagina: 1,
    })
  )
  .execute();
```

### Logs Estruturados

```typescript
// Logs autom√°ticos em JSON
{
  "timestamp": "2024-01-15T10:30:00.000Z",
  "level": "info",
  "endpoint": "/api-de-dados/viagens",
  "method": "GET",
  "statusCode": 200,
  "responseTime": 245,
  "rateLimitRemaining": 85,
  "correlationId": "abc123"
}
```

## üìö Documenta√ß√£o

### Estrutura do Projeto

```
mcp-portal-transparencia/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ clients/          # Clientes para cada endpoint
‚îÇ   ‚îú‚îÄ‚îÄ core/            # Classes principais (Orchestrator, Auth)
‚îÇ   ‚îú‚îÄ‚îÄ types/           # Interfaces TypeScript geradas
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # Utilit√°rios (logging, rate limiting)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # Ponto de entrada principal
‚îú‚îÄ‚îÄ docs/                # Documenta√ß√£o detalhada
‚îú‚îÄ‚îÄ examples/            # Exemplos de uso
‚îî‚îÄ‚îÄ tests/               # Testes unit√°rios e integra√ß√£o
```

### Scripts Dispon√≠veis

```bash
# Desenvolvimento
npm run dev          # Executar em modo desenvolvimento
npm run build        # Compilar TypeScript
npm run test         # Executar testes
npm run test:watch   # Testes em modo watch
npm run lint         # Verificar c√≥digo com ESLint
npm run format       # Formatar c√≥digo com Prettier

# Documenta√ß√£o
npm run docs:build   # Gerar documenta√ß√£o
npm run docs:serve   # Servir documenta√ß√£o localmente
```

## üß™ Testes

```bash
# Executar todos os testes
npm test

# Testes com cobertura
npm run test:coverage

# Testes de integra√ß√£o (requer API key)
npm run test:integration
```

## ü§ù Contribuindo

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa ISC - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üîó Links √öteis

- [Portal da Transpar√™ncia](https://portaldatransparencia.gov.br/)
- [API Documentation](https://api.portaldatransparencia.gov.br/swagger-ui/index.html)
- [Swagger JSON](https://api.portaldatransparencia.gov.br/v3/api-docs)
- [Decreto n¬∫ 8.777/2016](https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2016/decreto/d8777.htm)

## üìû Suporte

- **Issues**: [GitHub Issues](https://github.com/seu-usuario/mcp-portal-transparencia/issues)
- **Email**: listaapitransparencia@cgu.gov.br (CGU)
- **Documenta√ß√£o**: [Wiki do Projeto](https://github.com/seu-usuario/mcp-portal-transparencia/wiki)

---

**Desenvolvido com ‚ù§Ô∏è para promover a transpar√™ncia p√∫blica no Brasil**
